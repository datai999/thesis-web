{"version":3,"sources":["components/SubjectDepartmentTab.js","pages/council/CouncilTable.js"],"names":["tabs","contextHolder","subjectDepartments","map","e","id","tabName","name","MainComponent","URL","InnerComponent","history","useHistory","location","useLocation","headSubjectDepartment","user","permissions","includes","PERMISSIONS","HEAD_SUBJECT_DEPARTMENT","subjectDepartmentId","subjectDepartment","pathname","split","pop","initTabIndex","findIndex","toString","useState","tabIndex","setTabIndex","useEffect","push","activeTab","onActiveTabChange","variant","tab","index","fields","key","label","_style","width","sorter","filter","councilRoleFields","CouncilTable","queryPage","search","match","currentPage","Number","page","setPage","data","setData","currentUserInSubjectDepartment","loginUserHasAny","canCreate","ADMIN","canEdit","EDUCATION_STAFF","api","post","params","direction","then","sm","className","color","onClick","items","hover","columnFilter","tableFilter","itemsPerPageSelect","itemsPerPage","activePage","scopedSlots","time","item","reserveDate","startTime","endTime","members","Object","entries","_","groupBy","role","sort","a","b","displayOrder","size","row","code","multiLine","councilMember","member","degree","degreeName","firstName","lastName","content","email","actions","vertical","onActivePageChange","newPage","align","array"],"mappings":"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","file":"static/js/19.ab7f3361.chunk.js","sourcesContent":["import {\r\n  CCard,\r\n  CCardBody,\r\n  CNav,\r\n  CNavItem,\r\n  CNavLink,\r\n  CTabContent,\r\n  CTabPane,\r\n  CTabs,\r\n} from \"@coreui/react\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport contextHolder from \"src/service/contextService\";\r\nimport { PERMISSIONS } from \"./../service/permissionService\";\r\n\r\nconst tabs = contextHolder.subjectDepartments.map((e) => {\r\n  return {\r\n    id: e.id,\r\n    tabName: e.name,\r\n  };\r\n});\r\n\r\nconst MainComponent = ({ URL, InnerComponent }) => {\r\n  const history = useHistory();\r\n  const location = useLocation();\r\n  const headSubjectDepartment = contextHolder.user.permissions.includes(\r\n    PERMISSIONS.HEAD_SUBJECT_DEPARTMENT\r\n  );\r\n\r\n  const subjectDepartmentId = !headSubjectDepartment\r\n    ? location.pathname.split(\"/\").pop()\r\n    : contextHolder.user.subjectDepartment?.id;\r\n  const initTabIndex = tabs.findIndex(\r\n    (e) => e.id.toString() === subjectDepartmentId?.toString()\r\n  );\r\n\r\n  const [tabIndex, setTabIndex] = useState(initTabIndex < 0 ? 0 : initTabIndex);\r\n\r\n  useEffect(() => {\r\n    if (headSubjectDepartment) {\r\n      history.push(`${URL}/${contextHolder.user.subjectDepartment.id}`);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    history.push(`${URL}/${tabs[tabIndex].id}`);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [tabIndex]);\r\n\r\n  return (\r\n    <CCard>\r\n      <CCardBody>\r\n        <CTabs activeTab={tabIndex} onActiveTabChange={setTabIndex}>\r\n          <CNav variant=\"tabs\">\r\n            {tabs.map((e) => (\r\n              <CNavItem key={e.id}>\r\n                <CNavLink>{e.tabName}</CNavLink>\r\n              </CNavItem>\r\n            ))}\r\n          </CNav>\r\n          <CTabContent>\r\n            {tabs.map((tab, index) => (\r\n              <CTabPane>\r\n                {index === tabIndex && (\r\n                  <InnerComponent subjectDepartmentId={tab.id} />\r\n                )}\r\n              </CTabPane>\r\n            ))}\r\n          </CTabContent>\r\n        </CTabs>\r\n      </CCardBody>\r\n    </CCard>\r\n  );\r\n};\r\n\r\nexport default MainComponent;\r\n","import CIcon from \"@coreui/icons-react\";\r\nimport {\r\n  CButton,\r\n  CButtonGroup,\r\n  CCard,\r\n  CCardHeader,\r\n  CCol,\r\n  CDataTable,\r\n  CPagination,\r\n  CRow,\r\n  CTooltip,\r\n} from \"@coreui/react\";\r\nimport _ from \"lodash\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useHistory, useLocation } from \"react-router-dom\";\r\nimport SubjectDepartmentTab from \"src/components/SubjectDepartmentTab\";\r\nimport api from \"src/service/api\";\r\nimport contextHolder from \"src/service/contextService\";\r\nimport { loginUserHasAny, PERMISSIONS } from \"src/service/permissionService\";\r\n\r\nconst fields = [\r\n  { key: \"id\", label: \"Mã\", _style: { width: 1 } },\r\n  { key: \"semesterName\", label: \"Học kỳ\", _style: { width: 90 } },\r\n  { key: \"time\", label: \"Thời gian\", _style: { width: 140 } },\r\n  { key: \"location\", label: \"Địa điểm\", _style: { width: \"15%\" } },\r\n  { key: \"members\", label: \"Thành viên\", sorter: false },\r\n  { key: \"note\", label: \"Ghi chú\" },\r\n  {\r\n    key: \"actions\",\r\n    label: \"\",\r\n    _style: { width: 1 },\r\n    sorter: false,\r\n    filter: false,\r\n  },\r\n];\r\n\r\nconst councilRoleFields = [\r\n  { key: \"role\", label: \"Vai trò\" },\r\n  { key: \"code\", label: \"Mã số\" },\r\n  { key: \"degree\", label: \"Học vị\" },\r\n  { key: \"name\", label: \"Họ tên và email\" },\r\n];\r\n\r\nconst CouncilTable = ({ subjectDepartmentId }) => {\r\n  const history = useHistory();\r\n  const queryPage = useLocation().search.match(/page=([0-9]+)/, \"\");\r\n  const currentPage = Number(queryPage && queryPage[1] ? queryPage[1] : 1);\r\n  const [page, setPage] = useState(currentPage);\r\n  const [data, setData] = useState([]);\r\n  const size = 5;\r\n\r\n  const currentUserInSubjectDepartment =\r\n    loginUserHasAny([PERMISSIONS.HEAD_SUBJECT_DEPARTMENT]) &&\r\n    contextHolder.user.subjectDepartment?.id === subjectDepartmentId;\r\n\r\n  const canCreate =\r\n    currentUserInSubjectDepartment || loginUserHasAny([PERMISSIONS.ADMIN]);\r\n\r\n  const canEdit =\r\n    currentUserInSubjectDepartment ||\r\n    loginUserHasAny([PERMISSIONS.EDUCATION_STAFF, PERMISSIONS.ADMIN]);\r\n\r\n  const pageChange = (newPage) => {\r\n    currentPage !== newPage &&\r\n      history.push(`/councils/${subjectDepartmentId}?page=${newPage}`);\r\n    setPage(newPage);\r\n  };\r\n\r\n  const getData = () => {\r\n    api\r\n      .post(\r\n        `/councils/example`,\r\n        { subjectDepartment: subjectDepartmentId },\r\n        {\r\n          params: {\r\n            direction: \"DESC\",\r\n          },\r\n        }\r\n      )\r\n      .then(setData);\r\n  };\r\n\r\n  useEffect(() => {\r\n    getData();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (\r\n    <CCard>\r\n      <CCardHeader>\r\n        <CRow>\r\n          <CCol sm=\"5\">\r\n            <h5 className=\"card-title mb-0\">Danh sách hội đồng</h5>\r\n          </CCol>\r\n          {canCreate && (\r\n            <CCol sm=\"7\" className=\"d-none d-md-block\">\r\n              <CButton\r\n                color=\"primary\"\r\n                className=\"float-right\"\r\n                onClick={() => {\r\n                  history.push(`/councils/${subjectDepartmentId}/create`);\r\n                }}\r\n              >\r\n                Tạo hội đồng mới\r\n              </CButton>\r\n            </CCol>\r\n          )}\r\n        </CRow>\r\n      </CCardHeader>\r\n      <CDataTable\r\n        items={data}\r\n        fields={fields}\r\n        hover\r\n        sorter\r\n        columnFilter\r\n        tableFilter\r\n        itemsPerPageSelect\r\n        itemsPerPage={size}\r\n        activePage={page}\r\n        scopedSlots={{\r\n          time: (item) => (\r\n            <td>\r\n              <div>\r\n                {\"Ngày\"}\r\n                <div className=\"float-right\">{item.reserveDate}</div>\r\n              </div>\r\n              <div>\r\n                {\"Bắt đầu\"}\r\n                <div className=\"float-right\">{item.startTime}</div>\r\n              </div>\r\n              <div>\r\n                {\"Kết thúc\"}\r\n                <div className=\"float-right\">{item.endTime}</div>\r\n              </div>\r\n            </td>\r\n          ),\r\n          members: (item) => (\r\n            <td className=\"p-0\">\r\n              {\r\n                <CDataTable\r\n                  items={Object.entries(\r\n                    _.groupBy(item.members, (e) => e.role.name)\r\n                  ).sort(\r\n                    (a, b) =>\r\n                      a[1][0].role.displayOrder - b[1][0].role.displayOrder\r\n                  )}\r\n                  fields={councilRoleFields}\r\n                  size=\"sm\"\r\n                  scopedSlots={{\r\n                    role: (row) => <>{row[0]}</>,\r\n                    code: (row) =>\r\n                      multiLine(\r\n                        row[1].map((councilMember) => councilMember.member.code)\r\n                      ),\r\n                    degree: (row) =>\r\n                      multiLine(\r\n                        row[1].map(\r\n                          (councilMember) => councilMember.member.degreeName\r\n                        )\r\n                      ),\r\n                    name: (row) =>\r\n                      multiLine(\r\n                        row[1]\r\n                          .map((councilMember) => councilMember.member)\r\n                          .map((user) => (\r\n                            <div>\r\n                              {user.firstName} {user.lastName}{\" \"}\r\n                              <CTooltip content={user.email}>\r\n                                <CIcon\r\n                                  name=\"cil-envelope-closed\"\r\n                                  className=\"mb-2\"\r\n                                />\r\n                              </CTooltip>\r\n                            </div>\r\n                          ))\r\n                      ),\r\n                  }}\r\n                />\r\n              }\r\n            </td>\r\n          ),\r\n          actions: (item) => (\r\n            <td className=\"py-2\">\r\n              {canEdit && (\r\n                <CButtonGroup vertical size=\"sm\">\r\n                  <CTooltip content={\"Chỉnh sửa\"}>\r\n                    <CButton\r\n                      color=\"primary\"\r\n                      variant=\"outline\"\r\n                      onClick={() => {\r\n                        history.push(\r\n                          `/councils/${subjectDepartmentId}/edit/${item.id}`,\r\n                          item\r\n                        );\r\n                      }}\r\n                    >\r\n                      <CIcon name=\"cil-pencil\" />\r\n                    </CButton>\r\n                  </CTooltip>\r\n                </CButtonGroup>\r\n              )}\r\n            </td>\r\n          ),\r\n        }}\r\n      />\r\n      <CPagination\r\n        size=\"sm\"\r\n        activePage={page}\r\n        onActivePageChange={pageChange}\r\n        align=\"center\"\r\n      />\r\n    </CCard>\r\n  );\r\n};\r\n\r\nconst multiLine = (array = []) => (\r\n  <td>{array && array.map((e) => <div>{e}</div>)}</td>\r\n);\r\n\r\nconst MainComponent = () => (\r\n  <SubjectDepartmentTab URL=\"/councils\" InnerComponent={CouncilTable} />\r\n);\r\n\r\nexport default MainComponent;\r\n"],"sourceRoot":""}